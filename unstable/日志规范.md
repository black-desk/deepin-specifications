> __警告！此规范内容是不稳定版本，可能会发生破坏兼容性的更新。当无法保障向下兼容时，将会升级此文档的主版本号，如从“1.0”更新到“2.0”。反之，普通更新只会升级次版本号，如“1.0”更新到“1.1”，其对“1.0”版本向下兼容。请在使用前确认此文档的版本号，并为将来可能发生的兼容性变化做好准备。__

# 日志规范

* 维护者：Chen Linxuan <chenlinxuan@uniontech.com>
* 版本：1.0
* 修改日期：2024.6.7
* 议题：#9

The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL
NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED",  "MAY", and
"OPTIONAL" in this document are to be interpreted as described in
RFC 2119.

## 日志记录方式

桌面应用程序，包括后台服务和GUI应用程序在内，
都**必须（MUST）**使用journal[^1]协议向journald[^1]发送其日志。

[^1]: `man systemd-journald.service`

**推荐（RECOMMENDED）**使用`sd_journal_print`系列函数[^2]发送其日志。
虽然使用syslog协议或者直接打印日志在stdout/stderr中可以被journald记录到，
但是GUI桌面应用程序以及后台服务**禁止（MUST NOT）**这样做。

[^2]: `man sd_journal_print`

## 日志字段

记录日志的过程中除了jounral规定的部分特殊字段[^3]，
以及部分广泛应用的开源软件框架额外生成的字段以外，
本节会约定其他有特殊含义的字段：

[^3]: `man systemd.jounral-fields`

### `DSG_CATEGORY`

该字段用于表示该日志发送者的身份。

对于一个典型的，
由GUI部分以及其后台程序部分组成的应用程序`org.desktopspec.Demo`为例，
其图形进程的主窗口`MainWindow`模块发送的日志中，`DSG_CATEGORY`内容应为：

```
org.desktopspec.Demo.gui.MainWindow
```

而其后台进程中数据库相关模块`DataBase`发送的日志中，`DSG_CATEGORY`内容应为：

```
org.desktopspec.Demo.daemon.DataBase
```

该字段的内容为以下格式：

```
{应用名}[.{进程名|模块名}]
```

如果该应用并不想区分其不同进程的日志，
或者区分其不同模块的日志，
那么后续字段可以省略。

#### 库日志

如果开发库`org.desktopspec.SDK`中的`Utils`模块需要记录日志，
其`DSG_CATEGORY`内容应为：
```
org.desktopspec.SDK.Utils
```

### `DSG_MARK`

